<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Video Metadata Extractor</title>
<link rel="icon" href="imgvideo.png">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
  body {
    margin: 0;
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, #0b132b, #1c2541, #3a506b);
    color: #e0e0e0;
    height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
  }

  /* Splash */
  #splash {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: radial-gradient(circle at top, #0b132b, #000);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: cyan;
    z-index: 9999;
    animation: fadeOut 2s ease-in-out 2.5s forwards;
  }
  #splash h1 { font-size: 30px; text-shadow: 0 0 20px cyan; margin-bottom: 10px; }
  #splash p { font-size: 14px; color: #00ffffcc; }
  @keyframes fadeOut { to { opacity: 0; visibility: hidden; } }

  .wrapper {
    width: 850px;
    max-width: 95%;
    background: rgba(20, 30, 45, 0.6);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 20px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.5);
    backdrop-filter: blur(18px);
    padding: 35px;
    text-align: center;
    opacity: 0;
    animation: fadeIn 1.5s ease forwards 3s;
  }
  @keyframes fadeIn { to { opacity: 1; } }

  header {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    font-size: 28px;
    font-weight: 600;
    color: cyan;
    text-shadow: 0 0 12px cyan;
    margin-bottom: 25px;
  }
  header img { width: 40px; height: 40px; }

  .drop-zone {
    border: 2px dashed rgba(0,255,255,0.4);
    border-radius: 12px;
    padding: 40px 20px;
    transition: 0.3s;
  }
  .drop-zone.dragover {
    border-color: cyan;
    background-color: rgba(0,255,255,0.08);
  }
  .drop-zone p { margin: 10px 0 20px; font-size: 15px; color: #aaa; }

  button {
    background-color: cyan;
    color: #000;
    border: none;
    border-radius: 8px;
    padding: 10px 22px;
    font-weight: bold;
    cursor: pointer;
    margin: 6px;
    transition: 0.3s;
  }
  button:hover {
    background-color: #00ffffaa;
    box-shadow: 0 0 10px cyan;
  }
  .clear-btn {
    background-color: #ff5555;
    color: #fff;
  }
  .clear-btn:hover {
    background-color: #ff7777;
    box-shadow: 0 0 10px #ff4444;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 25px;
  }
  th, td { text-align: left; padding: 8px 10px; }
  th { border-bottom: 1px solid rgba(255,255,255,0.2); color: cyan; }
  tr:nth-child(even) { background-color: rgba(255,255,255,0.05); }

  .progress-container {
    width: 100%;
    background: rgba(255,255,255,0.1);
    border-radius: 10px;
    overflow: hidden;
    margin-top: 15px;
    height: 14px;
    position: relative;
  }
  .progress-bar {
    width: 0%;
    height: 100%;
    background: linear-gradient(90deg, cyan, #00ffaa);
    box-shadow: 0 0 10px cyan;
    transition: width 0.3s ease;
  }
  .progress-text {
    position: absolute;
    top: -25px;
    right: 10px;
    font-size: 14px;
    color: cyan;
  }

  footer { margin-top: 25px; font-size: 13px; color: #aaa; }
  footer span { color: cyan; font-weight: bold; }
</style>
</head>
<body>

  <!-- Splash -->
  <div id="splash">
    <h1>üé¨ Video Metadata Extractor</h1>
    <p>Developed by Mangeshh Gaykar</p>
  </div>

  <div class="wrapper">
    <header>
      <img src="imgvideo.png" alt="icon">
      <div>Video Metadata Extractor</div>
    </header>

    <div id="dropZone" class="drop-zone">
      <p>Drag & Drop your video files here</p>
      <button id="fileSelectBtn">Select Video Files</button>
      <input type="file" id="fileInput" multiple accept="video/*" style="display:none;">
      <button id="folderSelectBtn">Select Folder</button>
      <input type="file" id="folderInput" webkitdirectory directory multiple style="display:none;">
      <p>Supported formats: MP4, MKV, AVI, MOV, WMV</p>
    </div>

    <div style="text-align:center; margin-top:20px;">
      <button id="exportBtn">Export to Excel</button>
      <button id="clearBtn" class="clear-btn">üóë Clear All</button>
    </div>

    <div class="progress-container" id="progressContainer" style="display:none;">
      <div class="progress-bar" id="progressBar"></div>
      <div class="progress-text" id="progressText">0%</div>
    </div>

    <div id="tableContainer"></div>

    <footer>üßë‚Äçüíª Developed by <span>Mangeshh Gaykar</span></footer>
  </div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script>
  const dropZone = document.getElementById('dropZone');
  const fileInput = document.getElementById('fileInput');
  const folderInput = document.getElementById('folderInput');
  const fileSelectBtn = document.getElementById('fileSelectBtn');
  const folderSelectBtn = document.getElementById('folderSelectBtn');
  const exportBtn = document.getElementById('exportBtn');
  const clearBtn = document.getElementById('clearBtn');
  const progressContainer = document.getElementById('progressContainer');
  const progressBar = document.getElementById('progressBar');
  const progressText = document.getElementById('progressText');
  const tableContainer = document.getElementById('tableContainer');

  let selectedFiles = [];
  let metadataList = [];

  fileSelectBtn.onclick = () => fileInput.click();
  folderSelectBtn.onclick = () => folderInput.click();

  fileInput.addEventListener('change', e => handleFiles(e.target.files));
  folderInput.addEventListener('change', e => handleFiles(e.target.files));

  dropZone.addEventListener('dragover', e => {
    e.preventDefault();
    dropZone.classList.add('dragover');
  });
  dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));
  dropZone.addEventListener('drop', e => {
    e.preventDefault();
    dropZone.classList.remove('dragover');
    handleFiles(e.dataTransfer.files);
  });

  clearBtn.addEventListener('click', () => {
    selectedFiles = [];
    metadataList = [];
    tableContainer.innerHTML = "";
    progressBar.style.width = "0%";
    progressText.textContent = "0%";
  });

  function handleFiles(files) {
    const validFiles = [...files].filter(f => f.type.startsWith("video/"));
    selectedFiles = validFiles;
    analyzeVideosSequentially();
  }

  async function analyzeVideosSequentially() {
    if (!selectedFiles.length) return;
    metadataList = [];
    progressContainer.style.display = "block";
    progressBar.style.width = "0%";
    progressText.textContent = "0%";
    tableContainer.innerHTML = "";

    let totalDuration = 0;

    for (let i = 0; i < selectedFiles.length; i++) {
      const file = selectedFiles[i];
      await new Promise(resolve => {
        const video = document.createElement('video');
        video.preload = 'metadata';
        video.src = URL.createObjectURL(file);
        video.onloadedmetadata = () => {
          URL.revokeObjectURL(video.src);
          totalDuration += video.duration;
          metadataList.push({
            "File Name": file.name,
            "Duration": new Date(video.duration * 1000).toISOString().substr(11, 8),
            "Resolution": `${video.videoWidth}x${video.videoHeight}`,
            "Size": formatSize(file.size)
          });
          const progress = Math.round(((i + 1) / selectedFiles.length) * 100);
          progressBar.style.width = progress + "%";
          progressText.textContent = progress + "%";
          resolve();
        };
      });
    }

    progressText.textContent = "‚úÖ 100% Completed";
    setTimeout(() => { progressContainer.style.display = "none"; }, 800);
    displayTable(totalDuration);
  }

  function formatSize(bytes) {
    const mb = bytes / (1024 * 1024);
    return mb > 1024 ? (mb / 1024).toFixed(2) + " GB" : mb.toFixed(2) + " MB";
  }

  function formatTotalDuration(seconds) {
    const hrs = Math.floor(seconds / 3600);
    const mins = Math.floor((seconds % 3600) / 60);
    const secs = Math.floor(seconds % 60);
    return `${hrs.toString().padStart(2,'0')}:${mins.toString().padStart(2,'0')}:${secs.toString().padStart(2,'0')}`;
  }

  function displayTable(totalDuration = 0) {
    if (!metadataList.length) return;
    let html = "<table><tr><th>File Name</th><th>Duration</th><th>Resolution</th><th>Size</th></tr>";
    metadataList.forEach(m => {
      html += `<tr><td>${m["File Name"]}</td><td>${m["Duration"]}</td><td>${m["Resolution"]}</td><td>${m["Size"]}</td></tr>`;
    });
    html += `</table><br><p><strong>Total Videos:</strong> ${metadataList.length} &nbsp; | &nbsp; <strong>Total Duration:</strong> ${formatTotalDuration(totalDuration)}</p>`;
    tableContainer.innerHTML = html;
  }

  exportBtn.addEventListener('click', () => {
    if (!metadataList.length) return;

    let totalDuration = metadataList.reduce((acc, m) => {
      const [h, mnt, s] = m["Duration"].split(':').map(Number);
      return acc + h * 3600 + mnt * 60 + s;
    }, 0);

    const totalRow = {
      "File Name": "Total Videos: " + metadataList.length,
      "Duration": "Total Duration: " + formatTotalDuration(totalDuration),
      "Resolution": "",
      "Size": ""
    };

    const exportData = [...metadataList, {}, totalRow];
    const ws = XLSX.utils.json_to_sheet(exportData);

    // Apply bold style to headers and total row
    const range = XLSX.utils.decode_range(ws['!ref']);
    const lastRow = range.e.r;

    for (let C = range.s.c; C <= range.e.c; ++C) {
      const headerCell = ws[XLSX.utils.encode_cell({ r: 0, c: C })];
      if (headerCell) headerCell.s = { font: { bold: true } };

      const totalCell = ws[XLSX.utils.encode_cell({ r: lastRow, c: C })];
      if (totalCell && totalCell.v) totalCell.s = { font: { bold: true } };
    }

    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "Video Metadata");
    XLSX.writeFile(wb, "Video_Metadata_Report.xlsx", { cellStyles: true });
  });
</script>
</body>
</html>
