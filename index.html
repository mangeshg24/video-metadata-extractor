<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Video Metadata Extractor</title>
<link rel="icon" href="imgvideo.png">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
  body {
    margin: 0;
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, #0b132b, #1c2541, #3a506b);
    color: #e0e0e0;
    height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
  }

  /* Splash */
  #splash {
    position: fixed;
    inset: 0;
    background: radial-gradient(circle at top, #0b132b, #000);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    color: cyan;
    z-index: 9999;
    animation: fadeOut 2s ease-in-out 2.5s forwards;
  }
  @keyframes fadeOut { to { opacity: 0; visibility: hidden; } }
  #splash p { color: white; }

  .wrapper {
    width: 850px;
    max-width: 95%;
    background: rgba(20, 30, 45, 0.6);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 20px;
    padding: 35px;
    text-align: center;
    opacity: 0;
    animation: fadeIn 1.5s ease forwards 3s;
  }
  @keyframes fadeIn { to { opacity: 1; } }

  header {
    font-size: 28px;
    font-weight: 600;
    color: cyan;
    text-shadow: 0 0 12px cyan;
    margin-bottom: 25px;
  }

  .drop-zone {
    border: 2px dashed rgba(0,255,255,0.4);
    border-radius: 12px;
    padding: 40px 20px;
  }

  button {
    background-color: cyan;
    border: none;
    padding: 10px 22px;
    font-weight: bold;
    border-radius: 8px;
    cursor: pointer;
    margin: 6px;
  }

  .clear-btn {
    background-color: #ff5555;
    color: white;
  }

  .progress-container {
    width: 100%;
    background: rgba(255,255,255,0.2);
    height: 12px;
    border-radius: 10px;
    display: none;
    margin-top: 14px;
  }
  .progress-bar {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, cyan, #00ffaa);
  }

  #summaryInfo {
    color: white;
    font-size: 15px;
    margin-top: 10px;
    font-weight: 600;
    opacity: 0;
    transition: .4s ease;
  }

  #userMessage {
    color: cyan;
    display: none;
    margin-top: 12px;
  }

  footer {
    margin-top: 40px;        /* moved footer down */
    font-size: 13px;
    color: #aaa;
  }
  footer span {
    color: white;
    font-weight: bold;
  }
</style>
</head>

<body>

<div id="splash">
  <h1>üé¨ Video Metadata Extractor</h1>
  <p>Developed by <span style="color:white;">Mangeshh Gaykar</span></p>
</div>

<div class="wrapper">

  <header>Video Metadata Extractor</header>

  <div class="drop-zone">
    <p>Drag & Drop your video files here</p>

    <button id="fileSelectBtn">Select Video Files</button>
    <input type="file" id="fileInput" accept="video/*" multiple style="display:none;">

    <button id="folderSelectBtn">Select Folder</button>
    <input type="file" id="folderInput" webkitdirectory directory multiple style="display:none;">

    <p>Supported formats: MP4, MKV, AVI, MOV, WMV</p>

    <p id="summaryInfo"></p>
  </div>

  <button id="exportBtn">Export to Excel</button>
  <button id="clearBtn" class="clear-btn">üóë Clear All</button>

  <div class="progress-container" id="progressContainer">
    <div class="progress-bar" id="progressBar"></div>
  </div>

  <p id="userMessage"></p>

  <footer>üßë‚Äçüíª Developed by <span>Mangeshh Gaykar</span></footer>
</div>

<!-- Excel with styling -->
<script src="https://cdn.jsdelivr.net/npm/xlsx-js-style@1.2.0/dist/xlsx.min.js"></script>

<script>
let metadataList = [];

const fileInput = document.getElementById("fileInput");
const folderInput = document.getElementById("folderInput");
const summaryInfo = document.getElementById("summaryInfo");
const userMessage = document.getElementById("userMessage");
const progressContainer = document.getElementById("progressContainer");
const progressBar = document.getElementById("progressBar");

/* File selection handlers */
document.getElementById("fileSelectBtn").onclick = () => fileInput.click();
document.getElementById("folderSelectBtn").onclick = () => folderInput.click();

fileInput.onchange = e => processFiles(e.target.files);
folderInput.onchange = e => processFiles(e.target.files);

/* PROCESS FILES */
async function processFiles(files) {
  const valid = [...files].filter(f => f.type.startsWith("video/"));
  if (!valid.length) return;

  metadataList = [];
  summaryInfo.style.opacity = 0;
  userMessage.style.display = "none";

  progressContainer.style.display = "block";
  progressBar.style.width = "0%";

  let totalDuration = 0;

  for (let i = 0; i < valid.length; i++) {
    await new Promise(resolve => {
      const vid = document.createElement("video");
      vid.preload = "metadata";
      vid.src = URL.createObjectURL(valid[i]);

      vid.onloadedmetadata = () => {
        URL.revokeObjectURL(vid.src);

        totalDuration += vid.duration;

        metadataList.push({
          "File Name": valid[i].name,
          "Duration": new Date(vid.duration * 1000).toISOString().substr(11, 8),
          "Resolution": vid.videoWidth + "x" + vid.videoHeight,
          "Size": formatSize(valid[i].size)
        });

        progressBar.style.width = ((i + 1) / valid.length * 100) + "%";
        resolve();
      };
    });
  }

  progressContainer.style.display = "none";

  summaryInfo.innerHTML =
    `Total Videos: ${metadataList.length}<br>Total Duration: ${formatTotal(totalDuration)}`;
  summaryInfo.style.opacity = 1;

  userMessage.textContent = "Processing completed. Click Export to Excel for details report.";
  userMessage.style.display = "block";
}

/* Clear All FIXED */
document.getElementById("clearBtn").onclick = () => {
  metadataList = [];

  summaryInfo.style.opacity = 0;
  summaryInfo.innerHTML = "";

  userMessage.style.display = "none";
  userMessage.textContent = "";

  progressContainer.style.display = "none";
  progressBar.style.width = "0%";

  fileInput.value = "";
  folderInput.value = "";
};

/* Helpers */
function formatSize(bytes) {
  const mb = bytes / 1024 / 1024;
  return mb > 1024 ? (mb / 1024).toFixed(2) + " GB" : mb.toFixed(2) + " MB";
}
function formatTotal(sec) {
  const h = String(Math.floor(sec / 3600)).padStart(2, "0");
  const m = String(Math.floor((sec % 3600) / 60)).padStart(2, "0");
  const s = String(Math.floor(sec % 60)).padStart(2, "0");
  return `${h}:${m}:${s}`;
}

/* EXPORT TO EXCEL (works with styles) */
document.getElementById("exportBtn").onclick = () => {
  if (!metadataList.length) return;

  let total = metadataList.reduce((acc, row) => {
    const [h, m, s] = row["Duration"].split(":").map(Number);
    return acc + h * 3600 + m * 60 + s;
  }, 0);

  const totalRow = {
    "File Name": "Total Videos: " + metadataList.length,
    "Duration": "Total Duration: " + formatTotal(total),
    "Resolution": "",
    "Size": ""
  };

  const data = [...metadataList, {}, totalRow];

  const ws = XLSX.utils.json_to_sheet(data);

  ws['!cols'] = Object.keys(data[0]).map((k, i) => ({
    wch: Math.max(...data.map(r => (r[k] + '').length)) + 5
  }));

  const range = XLSX.utils.decode_range(ws['!ref']);
  const lastRow = range.e.r;

  for (let C = range.s.c; C <= range.e.c; C++) {

    let hd = ws[XLSX.utils.encode_cell({ r: 0, c: C })];
    if (hd) hd.s = { font: { bold: true, color: { rgb: "000000" } } };

    let tc = ws[XLSX.utils.encode_cell({ r: lastRow, c: C })];
    if (tc && tc.v)
      tc.s = { font: { bold: true, color: { rgb: "FF0000" } } };
  }

  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Video Metadata");

  XLSX.writeFile(wb, "Video_Metadata_Report.xlsx");
};
</script>

</body>
</html>
